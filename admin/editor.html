<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Console</title>

<!-- Ace Editor -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.3/ace.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.3/mode-yaml.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.3/theme-tomorrow_night.min.js"></script>

<style>
/* ===================== */
/* GLOBAL */
/* ===================== */
body {
  margin: 0;
  font-family: "Inter", system-ui, sans-serif;
  background: #f4f6f8;
  color: #2c2c2c;
}

h1 {
  font-size: 22px;
  margin-bottom: 20px;
}

h2 {
  font-size: 16px;
  margin-bottom: 12px;
  color: #422b23;
}

/* ===================== */
/* LAYOUT */
/* ===================== */
.admin-container {
  max-width: 1200px;
  margin: 40px auto;
  padding: 0 20px;
}

.card {
  background: #ffffff;
  border-radius: 14px;
  padding: 20px;
  box-shadow: 0 12px 28px rgba(0,0,0,0.08);
  margin-bottom: 28px;
}

/* ===================== */
/* CONTENT EDITOR */
/* ===================== */
.editor-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 12px;
}

select {
  padding: 6px 10px;
  border-radius: 8px;
  border: 1px solid #ccc;
}

#editor {
  height: 360px;
  width: 100%;
  border-radius: 10px;
  overflow: hidden;
}

button.primary {
  background: #422b23;
  color: white;
  border: none;
  padding: 10px 18px;
  border-radius: 22px;
  cursor: pointer;
  font-size: 13px;
}

button.primary:hover {
  background: #9b6b57;
}

/* ===================== */
/* REVIEWS */
/* ===================== */
.review-card {
  border: 1px solid #e3e3e3;
  border-radius: 12px;
  padding: 14px 16px;
  margin-bottom: 12px;
}

.review-card b {
  color: #422b23;
}

.review-card small {
  color: #777;
}

.review-card button {
  margin-top: 10px;
  padding: 6px 12px;
  border-radius: 14px;
  border: none;
  background: #7a5243;
  color: white;
  cursor: pointer;
}

.review-card button:hover {
  background: #9b6b57;
}

/* ===================== */
/* IMAGE UPLOAD */
/* ===================== */
.upload-row {
  display: flex;
  gap: 12px;
  align-items: center;
}

input[type="file"] {
  border: 1px solid #ccc;
  padding: 6px;
  border-radius: 8px;
}

#result {
  margin-top: 10px;
  font-size: 13px;
  color: #2e7d32;
}
</style>
</head>

<body>

<div class="admin-container">
  <h1>Admin Console</h1>

  <!-- CONTENT -->
  <div class="card">
    <div class="editor-header">
      <h2>Edit Page Content</h2>
      <select id="page">
        <option value="homepage">Homepage</option>
        <option value="products">Products</option>
	    <option value="gallery">Gallery</option>
      </select>
    </div>

    <div id="editor"></div>

    <br>
    <button class="primary" onclick="save()">Save & Build</button>
  </div>

  <!-- REVIEWS -->
  <div class="card">
    <h2>Pending Reviews</h2>
    <div id="reviews">Loadingâ€¦</div>
  </div>

  <!-- IMAGES -->
  <div class="card">
    <h2>Upload Image</h2>
    <div class="upload-row">
      <input type="file" id="image">
      <button class="primary" onclick="uploadImage()">Upload</button>
    </div>
    <p id="result"></p>
  </div>
</div>



<div class="section">
  <h2>Gallery Upload</h2>
  <input type="file" id="galleryImage">
  <button onclick="uploadGallery()">Upload to Gallery</button>
  <p id="galleryResult"></p>
</div>






<script>


function uploadGallery() {
  const file = document.getElementById('galleryImage').files[0];
  if (!file) return alert('Select image');

  const fd = new FormData();
  fd.append('image', file);

  fetch('/admin/upload-gallery', {
    method: 'POST',
    body: fd
  })
  .then(r => r.json())
  .then(r => {
    document.getElementById('galleryResult').innerText =
      'Added to gallery: ' + r.path;
  });
}

/* ===================== */
/* ACE EDITOR */
/* ===================== */
const aceEditor = ace.edit("editor");
aceEditor.setTheme("ace/theme/tomorrow_night");
aceEditor.session.setMode("ace/mode/yaml");
aceEditor.setOptions({
  fontSize: "13px",
  showPrintMargin: false,
  wrap: true
});

const page = document.getElementById('page');
const reviewsBox = document.getElementById('reviews');

/* ===================== */
/* LOAD PAGE */
/* ===================== */
function loadPage() {
  fetch(`/content/${page.value}.yml`)
    .then(r => r.text())
    .then(t => aceEditor.setValue(t, -1));
}

/* ===================== */
/* SAVE */
/* ===================== */
function save() {
  const yaml = aceEditor.getValue();

  fetch('/admin/save', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ page: page.value, yaml })
  })
  .then(r => r.text())
  .then(alert);
}

/* ===================== */
/* REVIEWS */
/* ===================== */
function loadReviews() {
  fetch('/admin/pending-reviews')
    .then(r => r.json())
    .then(pending => {
      reviewsBox.innerHTML = '';

      if (!Array.isArray(pending) || pending.length === 0) {
        reviewsBox.innerText = 'No pending reviews';
        return;
      }

      pending.forEach((r, i) => {
        const div = document.createElement('div');
        div.className = 'review-card';
        div.innerHTML = `
          <b>${r.name}</b><br>
          ${r.message}<br>
          <small>${r.date}</small><br>
          <button onclick="approve(${i})">Approve</button>
        `;
        reviewsBox.appendChild(div);
      });
    })
    .catch(() => reviewsBox.innerText = 'Failed to load reviews');
}

function approve(i) {
  fetch('/admin/approve-review', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ index: i })
  })
  .then(r => r.text())
  .then(msg => {
    alert(msg);
    loadReviews();
  });
}

/* ===================== */
/* UPLOAD */
/* ===================== */
function uploadImage() {
  const f = document.getElementById('image').files[0];
  if (!f) return alert('Select an image');

  const fd = new FormData();
  fd.append('image', f);

   fetch('/admin/upload-image',{ method: 'POST', body: fd })
    .then(r => r.json())
    .then(r => {
      document.getElementById('result').innerText =
        'Uploaded. Use path: ' + r.path;
    });
}

page.onchange = loadPage;
window.onload = () => { loadPage(); loadReviews(); };
</script>

</body>
</html>
